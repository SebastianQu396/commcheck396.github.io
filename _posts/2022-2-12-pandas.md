---
layout: post
title: 'Pandas便签'
date: 2022-2-12
author: 不显电性
cover: 'http://commcheck396.github.io/assets/img/2022_1_26/pandas.png'
tags: Python Pandas
---

> Numpy类似于Python中的list，而Pandas则类似于Python中的Dictionary，最最重要的是它可以提供xls文件的互联端口，香！

<br/>

## 数据的提取与保存
### 数据的提取

```py
df = pd.read_excel("data/体检数据.xlsx", index_col=0)
print(df)
#使用 index_col=0 就是告诉 Pandas，让它使用第一个 column（学号）的数据当做 row 索引。 后面还有很多读取的功能里也有一样的参数。
#     姓名   身高  体重   肺活量
# 学号                   
# 1   小明  168  60  3200
# 2   小黄  187  80  3800
# 3   小花  170  70  3400

# 若没有index_col=0，则会有如下输出，会多了一列 Unnammed：0
#    学号  姓名   身高  体重   肺活量
# 0   1  小明  168  60  3200
# 1   2  小黄  187  80  3800
# 2   3  小花  170  70  3400
```

### 数据的保存
```py
df.to_excel("data/体检数据_修改.xlsx")
```

### 文本格式数据的提取
txt，csv，log 等这些都可以是纯文本文件，不过值得注意的是，对于 Pandas，它只对结构化的纯文本文件感兴趣。
```py
df_csv = pd.read_csv("data/体检数据_sep.csv", index_col=0, sep="=")
# 可以利用read_csv来读取文件，sep参数为数据分割符
df_txt.to_csv("data/体检数据_sep_修改.csv")
# 保存
```

## 数据的创建及转换
### 数据序列Series
```py
l = [11,22,33]
s = pd.Series(l)
print("series:", s)
# 0    11
# 1    22
# 2    33
# dtype: int64
```
Numpy，list，Pandas之间的数据可以进行互通：
```py
pd.Series(np.random.rand(3), index=["a", "b", "c"]) # Numpy->Pandas
pd.Series(l, index=["a", "b", "c"]) #list->Pandas
s.to_numpy() # Pandas->Numpy
s.values.tolist() # Pandas->list
```
### 数据表DataFrame
```py
df = pd.DataFrame({"col1": [1,3], "col2": [2, 4]})
#    col1  col2
# 0     1     2
# 1     3     4
# 外圈的0，1为数据的索引

df.at[0, 1] # 可以通过这种方式查询位置为（0，1）的元素
# 2

# 当然，将Pandas抽出来一行就是Series。
print(df["col1"], "\n")
# 0    1
# 1    3
# Name: col1, dtype: int64 

# 两条Series合并起来就是一个DataFrame
df = pd.DataFrame({"col1": pd.Series([1,3]), "col2": pd.Series([2, 4])})
#    col1  col2
# 0     1     2
# 1     3     4

# 也可以利用index参数构建特殊索引
df = pd.DataFrame({"col1": [1,3], "col2": [2, 4]}, index=["a", "b"])
#    col1  col2
# a     1     2
# b     3     4

print(df.index)
print(df.columns) # 查看index和columns
# Index(['a', 'b'], dtype='object') 
# Index(['col1', 'col2'], dtype='object')
```
## 选取数据
仅仅用at选择数据未免太low了些。  
DataFrame 会分 Column 和 Row（index）。通常我们的 Column 是特征，Row 是数据样本。  
```py
data = np.arange(-12, 12).reshape((6, 4))
df = pd.DataFrame(
  data, 
  index=list("abcdef"), 
  columns=list("ABCD"))

df["B"]
# a   -11
# b    -7
# c    -3
# d     1
# e     5
# f     9
# Name: B, dtype: int32

print("\ndf:\n", df[["C", "B"]])
#     C   B
# a -10 -11
# b  -6  -7
# c  -2  -3
# d   2   1
# e   6   5
# f  10   9
```
### 巧用loc
```py
df.loc["c":"d", "B":"D"] # 注意此处与Numpy的区别，这里的两个区间均为闭区间
#    B  C  D
# c -3 -2 -1
# d  1  2  3

print("\ndf:\n", df.loc[["d", "b"], :]) # 当然，也可以单独进行选择
#     A  B  C  D
# d  0  1  2  3
# b -8 -7 -6 -5

# 若我不知道索引的名字，仅指导索引的位置，无妨，Pandas中提供了转换的方式，下面分别为index和column的转换方式
row_labels = df.index[2:4]
print("\ndf:\n", df.loc[row_labels, ["A", "C"]])
#     A  C
# c -4 -2
# d  0  2

col_labels = df.columns[[0, 3]]
print("\ndf:\n", df.loc[row_labels, col_labels])
#     A  D
# c -4 -1
# d  0  3
```
### 妙用iloc
```py
# 这玩意和Numpy一模一样
print("\ndf:\n", df.iloc[2:3, 1:3]) # 纯纯的平索引找元素，范围也变成了开区间
#    B  C
# c -3 -2

# 与loc一样，在iloc中也存在索引位置与索引名的转换方式
col_index = df.columns.get_indexer(["A", "B"])
print("\ndf:\n", df.iloc[:2, col_index])
#      A   B
# a -12 -11
# b  -8  -7

df.index.get_indexer(["a", "b"]) # 可以获得label 对应的 index 信息
```

## 条件过滤
这一部分堪称Numpy Pro  
可以用 .loc 或者 .iloc 来做过滤处理。然后用 .loc 来做筛选。由于过滤后的数据是索引名，所以不能利用iloc进行筛选。
```py
# 直接在Column中进行筛选
df[df["A"] < 0] # 选在 A Column 中小于 0 的那些数据
#     A   B   C  D
# a -12 -11 -10 -9
# b  -8  -7  -6 -5
# c  -4  -3  -2 -1

print("~:\n", df.loc[:, ~(df.iloc[0] < -10)])
print("\n>=:\n", df.loc[:, df.iloc[0] >= -10]) # 这两种方法均可以实现选取在第一行数据中不小于-10的数据的功能
#      C   D
# a -10  -9
# b  -6  -5
# c  -2  -1
# d   2   3
# e   6   7
# f  10  11


# 你甚至可以利用|，&表达组合逻辑
i0 = df.iloc[0]
df.loc[:, ~(i0 < -10) | (i0 < -11)] # 选在第一行数据不小于 -10 或小于 -11 的数据
#     A   C   D
# a -12 -10  -9
# b  -8  -6  -5
# c  -4  -2  -1
# d   0   2   3
# e   4   6   7
# f   8  10  11
```

## 统计方法
依旧是，Numpy Pro
```py
df.describe() # 给爷做个汇报
```