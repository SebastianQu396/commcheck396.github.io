---
layout: post
title: 'Numpy便签'
date: 2022-2-10
author: 不显电性
cover: 'http://commcheck396.github.io/assets/img/2022_1_26/numpy.png'
tags: Python Numpy
---

# ~~补~~

> Numpy是类似于Python list的数据结构

# 基本操作

## 创建变量
```py 
cars = np.array([ # 与list类似
[
    [5, 10, 12, 6],
    [5.1, 8.2, 11, 6.3],
    [4.4, 9.1, 10, 6.6]
],
[
    [6, 11, 13, 7],
    [6.1, 9.2, 12, 7.3],
    [5.4, 10.1, 11, 7.6]
],
])

print("总维度：", cars.ndim) # .ndim可以查询数据维度
print("场地 1 数据：\n", cars[0], "\n场地 1 维度：", cars[0].ndim)
print("场地 2 数据：\n", cars[1], "\n场地 2 维度：", cars[1].ndim)
```

## 数据类型


## 添加数据
### 对于一维的数据，直接进行合并
```py
cars1 = np.array([5, 10, 12, 6])
cars2 = np.array([5.2, 4.2])
cars = np.concatenate([cars1, cars2])

#cars=[ 5.  10.  12.   6.   5.2  4.2]
```
### 若将数据扩大至二维
```py
test1 = np.array([5, 10, 12, 6])
test2 = np.array([5.1, 8.2, 11, 6.3])

# 首先需要把它们都变成二维，下面这两种方法都可以加维度
test1 = np.expand_dims(test1, 0)
test2 = test2[np.newaxis, :]

# test1=[[ 5 10 12  6]]
# test2=[[ 5.1  8.2 11.   6.3]]

# 然后再在第一个维度上叠加
all_tests = np.concatenate([test1, test2])
# all= [[ 5.  10.  12.   6. ] [ 5.1  8.2 11.   6.3]]
```

### 在不同维度进行合并
```py
# Take data 'all_tests' above for example
print("第一维度叠加：\n", np.concatenate([all_tests, all_tests], axis=0))
# 第一维度叠加：
#  [[ 5.  10.  12.   6. ]
#  [ 5.1  8.2 11.   6.3]
#  [ 5.  10.  12.   6. ]
#  [ 5.1  8.2 11.   6.3]]


print("第二维度叠加：\n", np.concatenate([all_tests, all_tests], axis=1))
# 第二维度叠加：
#  [[ 5.  10.  12.   6.   5.  10.  12.   6. ]
#  [ 5.1  8.2 11.   6.3  5.1  8.2 11.   6.3]]

# Not hard to understand

# 其实，只要维度能够对齐，你可以在任意维度上进行合并操作。注意，有些数据维度是对不齐的，这样没办法合并

a = np.array([
[1,2,3],
[4,5,6]
])
b = np.array([
[7,8],
[9,10]
])

print(np.concatenate([a,b], axis=1))  # 这个没问题
# [[ 1  2  3  7  8]
#  [ 4  5  6  9 10]]

# print(np.concatenate([a,b], axis=0))  # 这个会报错:(

```
### 还有更加便捷的直接进行水平/垂直方向合并的指令`np.vstack()`, `np.hstack()`

| |  | 
| --- | --- | 
| 1 | 2 |
| 3 | 4 |
| 5 | 6 |
 | 7 | 8 |

<br/>

| |  |  |  |
| --- | --- | --- | --- |
| 1 | 2 | 5 | 6 |
| 3 | 4 | 7 | 8 |

```py
a = np.array([
[1,2],
[3,4]
])
b = np.array([
[5,6],
[7,8]
])
print("竖直合并\n", np.vstack([a, b]))
# 竖直合并
#  [[1 2]
#  [3 4]
#  [5 6]
#  [7 8]]
print("水平合并\n", np.hstack([a, b]))
# 水平合并
#  [[1 2 5 6]
#  [3 4 7 8]]

```
### 高级合并
列合并
```py
feature_a = np.array([1,2,3,4,5,6])
feature_b = np.array([11,22,33,44,55,66])
c_stack = np.column_stack([feature_a, feature_b])
print(c_stack)
# [[ 1 11]
#  [ 2 22]
#  [ 3 33]
#  [ 4 44]
#  [ 5 55]
#  [ 6 66]]
```
行合并
```py
sample_a = np.array([0, 1.1])
sample_b = np.array([1, 2.2])
c_stack = np.row_stack([sample_a, sample_b])
print(c_stack)
# [[0.  1.1]
#  [1.  2.2]]
```
### 拆解
横着切
```py
a = np.array(
[[ 1, 11, 2, 22],
 [ 3, 33, 4, 44],
 [ 5, 55, 6, 66],
 [ 7, 77, 8, 88]]
)
print(np.vsplit(a, indices_or_sections=2))  # 分成两段
print(np.vsplit(a, indices_or_sections=[2,3]))  # 0~2 一段，2~3 一段，3~一段
# [array([[ 1, 11,  2, 22],
#        [ 3, 33,  4, 44]]), array([[ 5, 55,  6, 66],
#        [ 7, 77,  8, 88]])]
# [array([[ 1, 11,  2, 22],
#        [ 3, 33,  4, 44]]), array([[ 5, 55,  6, 66]]), array([[ 7, 77,  8, 88]])]

```
竖着切
```py
a = np.array(
[[ 1, 11, 2, 22],
 [ 3, 33, 4, 44],
 [ 5, 55, 6, 66],
 [ 7, 77, 8, 88]]
)
print(np.split(a, indices_or_sections=2, axis=0))  # 分成两段
print(np.split(a, indices_or_sections=[2,3], axis=1))  # 在第二维度， 0~2 一段，2~3 一段，3~一段
# [array([[ 1, 11,  2, 22],
#        [ 3, 33,  4, 44]]), array([[ 5, 55,  6, 66],
#        [ 7, 77,  8, 88]])]
# [array([[ 1, 11],
#        [ 3, 33],
#        [ 5, 55],
#        [ 7, 77]]), array([[2],
#        [4],
#        [6],
#        [8]]), array([[22],
#        [44],
#        [66],
#        [88]])]
```
~~其实是没啥大用~~

## array形态改变
善用`reshape`
```py
test1 = np.array([5, 10, 12, 6])
test1.reshape(4,-1) # 要求行数为4，列数不限，参数为-1时为不限
# test1=[[ 5] [10] [12] [ 6]]
test1.reshape(2,-1,1)
# test1=[[[ 5]  [10]] [[12]  [ 6]]]
# Attention:reshape参数中不可以出现两个及以上-1
```
利用`shape`观察矩阵形态
```py
test1 = np.array([5, 10, 12, 6])
test1.reshape(2,-1,1)
#test1.shape=(2,2,1)
```

## 数据选取
### 单个选取
和list一样，[x][y]=[x,y]，代表选择第x行，第y列的元素  
当然，也有比较刁钻的部分
```py
b = np.array([
[1,2,3,4],
[5,6,7,8],
[9,10,11,12]
])
# 如果对应到数据，要竖着看，我也不知道为啥
# 第一个拿的是数据位是 [1,2]
# 第二个拿的是 [0,3]
print("b[[1,0],[2,3]]:\n", 
b[[1,0],
[2,3]])
# [7 4]
```
### 切片选取
#### 巧用`:`
```py
# [x:y]代表数组中[x,y)范围的数字，若略去则代表首/尾，若x/y为负数，也不难理解嘛，就是倒着数呗
a = np.array([1, 2, 3])
print("a[0:-1]：\n", a[0:-1])
# [1 2]
print("a[1:]：\n", a[1:])
# [2 3]
print("a[-2:]：\n", a[-2:])
# [2 3]

# [x:y:z]代表[x,y)范围的数字，选取步长为z
a = np.arange(10)  
b = a[2:7:2]   # 从索引 2 开始到索引 7 停止，间隔为 2
print(b)
# [2  4  6]
```
#### 多维亦然
```py
b = np.array([
[1,2,3,4],
[5,6,7,8],
[9,10,11,12]
])

print("b[:2]:\n", b[:2]) #EZ
#  [[1 2 3 4]
#  [5 6 7 8]]

print("b[:2, :3]:\n", b[:2, :3]) # 行选取[0,2),列选择[0,3)
#  [[1 2 3]
#  [5 6 7]]

print("b[1:3, -2:]:\n", b[1:3, -2:])
#  [[ 7  8]
#  [11 12]]
```
#### 也可以用这种方式对矩阵批量进行选取
```py
a = np.arange(10)
s = slice(2,7,2)   # 从索引 2 开始到索引 7 停止，间隔为2
print (a[s])
# 不难理解
```
### 条件筛选
#### 基础操作，看码说话
```py
a = np.array([
[1,2,3,4],
[5,6,7,8],
[9,10,11,12]
])

print(a[a>7])
# [ 8  9 10 11 12]

# 当然，也可以
condition = a > 7
print(condition)
# [[False False False False]
#  [False False False  True]
#  [ True  True  True  True]]

print(a[condition])
# [ 8  9 10 11 12]
```
#### 有一个更厉害的函数专门用来进行数据筛选
这种筛选更强大，它还能做筛选结果的替换工作。 它可已将满足条件的位置变成你设定的数字。下面满足条件的，都改成 -1，不满足的，都还是 a 里面的数字。
```py
condition = a > 7
print(np.where(condition, -1, a))
# [[ 1  2  3  4]
#  [ 5  6  7 -1]
#  [-1 -1 -1 -1]]
```
当然也可
```py
condition = a > 7
print(np.where(condition, -1, 2))
# [[ 2  2  2  2]
#  [ 2  2  2 -1]
#  [-1 -1 -1 -1]]
```
甚至
```py
condition = a > 7
b = -a - 1
print(np.where(condition, a, b))
# [[-2 -3 -4 -5]
#  [-6 -7 -8  8]
#  [ 9 10 11 12]]
``` 

## 基础运算
### 加减乘除，贼快贼牛逼
```py
a = np.array([150, 166, 183, 170])
print(a + 3)
# [153 169 186 173]
# 我他妈连循环都不用，并行就加好了
```
### 矩阵运算
```py
# 点乘
a = np.array([
[1, 2],
[3, 4]
])
b = np.array([
[5, 6],
[7, 8]
])

print(a.dot(b))
# [[19 22]
#  [43 50]]
```
内积外积啥的就算了，我不懂，懒得学
### 数据分析
`a.max(), a.min()`最大最小  
`a.sum()，a.prod()`累加累乘
`a.size，np.count_nonzero(a)`总数和非零总数  
`np.mean(month_salary),np.median(month_salary)`平均数中位数  
`np.std(month_salary)`标准差
`np.argmax(a),np.argmin(a)`最高最矮的索引
`np.floor(a)),np.ceil(a))`抹零还是进位
`a.clip(x, y)`将a中的元素限定在x和y之间，多砍少补